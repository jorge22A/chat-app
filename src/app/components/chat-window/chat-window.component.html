<div class="chat-window">
  @if (activeChat()) {
    <div class="chat-header">
      
      <button class="back-button" (click)="goBack()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
      </button>
      
      <div class="contact-info">
        <img [src]="activeChat()!.avatar" [alt]="activeChat()!.contactName" class="contact-avatar">
        <div class="contact-details">
          <span class="contact-name">{{ activeChat()!.contactName }}</span>
          <span class="contact-status">{{ activeChat()!.status === 'online' ? 'En línea' : 'Desconectado' }}</span>
        </div>
      </div>
    </div>

    <div class="messages-container" #messagesContainer>
      @for (message of messages(); track message.id) {
        <div class="message" [class.sent]="message.sender === 'user'" [class.received]="message.sender === 'contact'">
          <div class="message-content">
            <p>{{ message.content }}</p>
            <span class="message-time">{{ message.timestamp | dateFormat }}</span>
          </div>
        </div>
      } @empty {
        <div class="no-messages">
          <p>No hay mensajes aún. ¡Envía el primero!</p>
        </div>
      }
    </div>

    <div class="input-container">
      <input 
        type="text" 
        placeholder="Escribe un mensaje..." 
        class="message-input"
        [value]="newMessage()"
        (input)="updateMessage($event)"
        (keypress)="onKeyPress($event)"
      >
      <button class="send-btn" (click)="sendMessage()" [disabled]="!newMessage().trim()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
        </svg>
      </button>
    </div>
  } @else {
    <div class="no-chat-selected">
      
      <button class="back-button back-button-empty" (click)="goBack()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
      </button>
      
      <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
        <h2>Bienvenido al Chat</h2>
        <p>Selecciona una conversación para comenzar</p>
      </div>
    </div>
  }
</div>